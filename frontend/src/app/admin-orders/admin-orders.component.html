<div class="admin-orders-container">
  <div class="admin-content">
    <div class="admin-header">
      <h2>ğŸ“‹ Order Management</h2>
      <div class="order-stats" *ngIf="orders.length > 0">
        <span class="stat-item">Total Orders: {{orders.length}}</span>
        <span class="stat-item">New: {{getOrdersByStatus('New').length}}</span>
        <span class="stat-item">Processing: {{getOrdersByStatus('Processing').length}}</span>
        <span class="stat-item">Delivered: {{getOrdersByStatus('Delivered').length}}</span>
      </div>
    </div>

  <div class="filters">
    <label>
      Filter by Status:
      <select [(ngModel)]="filterStatus" (change)="loadOrders()">
        <option value="">All</option>
        <option *ngFor="let s of statuses" [value]="s">{{ s }}</option>
      </select>
    </label>

    <label>
      Filter by Payment Status:
      <select [(ngModel)]="filterPaymentStatus" (change)="loadOrders()">
        <option value="">All</option>
        <option *ngFor="let ps of paymentStatuses" [value]="ps">
          {{ ps }}
        </option>
      </select>
    </label>
  </div>

  <div class="table-container">
    <div class="table-scroll-hint">ğŸ“± Swipe left to see all columns</div>
    <table>
      <thead>
        <tr>
          <th>Order ID</th>
          <th>Customer</th>
          <th>Contact</th>
          <th>Address</th>
          <th>Payment Method</th>
          <th>Total (â‚±)</th>
          <th>Delivery Date</th>
          <th>Payment Status</th>
          <th>Order Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let order of orders">
          <td>{{ order.id }}</td>
          <td>{{ order.customer_name }}</td>
          <td>{{ order.phone }}</td>
          <td>{{ order.address }}</td>
          <td>{{ order.payment_method }}</td>
          <td>{{ order.total_price }}</td>
          <td>
            <input
              type="text"
              [value]="order.requested_delivery | date : 'short'"
              (change)="onDeliveryDateChange(order, $event)"
              class="delivery-date-input"
              title="Edit delivery date (MM/DD/YYYY HH:MM format)"
              placeholder="MM/DD/YYYY HH:MM"
            />
          </td>
          <td>
            <select
              [(ngModel)]="order.payment_status"
              (ngModelChange)="updatePaymentStatus(order, $event)"
            >
              <option *ngFor="let ps of paymentStatuses" [value]="ps">
                {{ ps }}
              </option>
            </select>
          </td>
          <td>
            <select
              [(ngModel)]="order.status"
              (ngModelChange)="updateStatus(order, $event)"
            >
              <option *ngFor="let s of statuses" [value]="s">
                {{ s }}
              </option>
            </select>
          </td>
          <td>
            <button 
              class="view-details-btn"
              (click)="viewOrderDetails(order)"
              [disabled]="loadingOrderDetails"
              type="button"
              title="View order details"
            >
              <span *ngIf="!loadingOrderDetails">ğŸ‘ï¸ View</span>
              <span *ngIf="loadingOrderDetails">â³</span>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

    <div *ngIf="loading" class="loading">Loading orders...</div>
    <div *ngIf="error" class="error">{{ error }}</div>
  </div>
</div>

<!-- Confirmation Modal -->
<app-confirmation-modal
  [isVisible]="showConfirmModal"
  [title]="confirmModalTitle"
  [message]="confirmModalMessage"
  confirmText="Confirm"
  cancelText="Cancel"
  confirmButtonClass="confirm-btn"
  (confirmed)="onConfirmModalConfirmed()"
  (cancelled)="onConfirmModalCancelled()">
</app-confirmation-modal>

<!-- Notification Modal -->
<app-notification-modal
  [isVisible]="showNotificationModal"
  [type]="notificationType"
  [title]="notificationTitle"
  [message]="notificationMessage"
  [details]="notificationDetails"
  [autoClose]="true"
  [autoCloseDelay]="3000"
  (closeModal)="onNotificationModalClosed()">
</app-notification-modal>

<!-- Order Details Modal -->
<app-order-details-modal
  [isVisible]="showOrderDetailsModal"
  [orderDetails]="selectedOrderDetails"
  (closeModal)="onOrderDetailsModalClosed()">
</app-order-details-modal>

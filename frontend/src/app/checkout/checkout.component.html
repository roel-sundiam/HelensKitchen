<div class="checkout-container">
  <!-- Order Success Message -->
  <div *ngIf="orderSubmitted" class="order-success">
    <div class="success-content">
      <div class="success-icon">‚úÖ</div>
      <h1>Order Submitted Successfully!</h1>
      <div class="order-details">
        <h3>Order #{{orderId}}</h3>
        <p>Thank you for your order! We've received your order and will begin processing it shortly.</p>
        <p><strong>Next Steps:</strong></p>
        <ul>
          <li>Payment verification will be processed</li>
          <li>Delivery will be scheduled as requested</li>
        </ul>
      </div>
      
      <div class="action-buttons">
        <button class="primary-btn" (click)="trackOrder()">
          üìã Track Your Order
        </button>
        <button class="secondary-btn" (click)="goToFeedback()">
          üí¨ Leave Feedback
        </button>
        <button class="tertiary-btn" (click)="startNewOrder()">
          üõí Place New Order
        </button>
      </div>
    </div>
  </div>

  <!-- Order Summary Section -->
  <div *ngIf="!orderSubmitted" class="order-summary">
    <h2>Order Summary</h2>
    
    <div *ngIf="cartItems.length === 0" class="empty-cart">
      <p>Your cart is empty. <a routerLink="/">Continue shopping</a></p>
    </div>
    
    <div *ngIf="cartItems.length > 0">
      <div class="order-items">
        <div *ngFor="let item of cartItems" class="order-item">
          <img [src]="item.menuItem.image_url" [alt]="item.menuItem.name" class="item-image" />
          <div class="item-details">
            <h4>{{ item.menuItem.name }}</h4>
            <p class="variant">{{ item.variant }}</p>
            <p class="quantity">Qty: {{ item.quantity }}</p>
          </div>
          <div class="item-price">
            ‚Ç±{{ (item.price * item.quantity).toFixed(2) }}
          </div>
        </div>
      </div>
      
      <div class="order-total">
        <h3>Total: ‚Ç±{{ getCartTotal().toFixed(2) }}</h3>
      </div>
    </div>
  </div>

  <!-- Checkout Form Section -->
  <div *ngIf="!orderSubmitted" class="checkout-form">
    <h2>Delivery Information</h2>
    <form [formGroup]="checkoutForm" (ngSubmit)="onSubmit()">
  <label>
    Name:
    <input formControlName="name" placeholder="Enter your full name" />
    <div
      *ngIf="
        checkoutForm.get('name')?.invalid && checkoutForm.get('name')?.touched
      "
      class="error-message"
    >
      Name is required.
    </div>
  </label>

  <label>
    Phone:
    <input formControlName="phone" placeholder="Enter your phone number" />
    <div
      *ngIf="
        checkoutForm.get('phone')?.invalid && checkoutForm.get('phone')?.touched
      "
      class="error-message"
    >
      Enter valid phone number (10-15 digits).
    </div>
  </label>

  <label>
    Address:
    <textarea formControlName="address" placeholder="Enter your delivery address"></textarea>
    <div
      *ngIf="
        checkoutForm.get('address')?.invalid &&
        checkoutForm.get('address')?.touched
      "
      class="error-message"
    >
      Address is required.
    </div>
  </label>

  <label>
    Plus Code (Optional - for precise delivery location):
    <div class="plus-code-input-group">
      <input formControlName="plusCode" placeholder="e.g., 3JVG+HG5" />
      <button 
        type="button" 
        class="get-location-btn"
        (click)="getCurrentLocation()"
        [disabled]="isGettingLocation"
      >
        {{ isGettingLocation ? 'Getting Location...' : 'üìç Get My Location' }}
      </button>
    </div>
    <div class="help-text">
      <small>Plus Codes help delivery riders find your exact location. Click the button to auto-fill with your current location.</small>
    </div>
    <div
      *ngIf="
        checkoutForm.get('plusCode')?.invalid &&
        checkoutForm.get('plusCode')?.touched
      "
      class="error-message"
    >
      Please enter a valid Plus Code format (e.g., 3JVG+HG5).
    </div>
  </label>

  <label>
    Payment Method:
    <select formControlName="paymentMethod">
      <option value="" disabled>Select payment method</option>
      <option *ngFor="let method of paymentMethods" [value]="method">
        {{ method }}
      </option>
    </select>
    <div
      *ngIf="
        checkoutForm.get('paymentMethod')?.invalid &&
        checkoutForm.get('paymentMethod')?.touched
      "
      class="error-message"
    >
      Payment method is required.
    </div>
  </label>

  <div *ngIf="checkoutForm.get('paymentMethod')?.value">
    <p><strong>Payment Instructions:</strong></p>
    <p>{{ getPaymentInstructions() }}</p>
  </div>

  <label>
    Requested Delivery Date & Time:
    <input type="datetime-local" formControlName="deliveryDateTime" />
    <div
      *ngIf="
        checkoutForm.get('deliveryDateTime')?.errors?.['invalidDate'] &&
        checkoutForm.get('deliveryDateTime')?.touched
      "
      class="error-message"
    >
      Delivery must be at least 24 hours from now.
    </div>
  </label>

      <!-- Debug information -->
      <div style="background: rgba(255,255,255,0.1); padding: 1rem; margin: 1rem 0; border-radius: 8px;" *ngIf="true">
        <p><strong>Debug Info:</strong></p>
        <p>Cart Items: {{ cartItems.length }}</p>
        <p>Form Valid: {{ checkoutForm.valid }}</p>
        <p>Form Errors: {{ getFormErrors() }}</p>
      </div>

      <button type="submit" [disabled]="cartItems.length === 0 || checkoutForm.invalid">
        Submit Order
      </button>
    </form>
  </div>
</div>

<!-- Error Modal -->
<app-error-modal
  [isVisible]="showErrorModal"
  [title]="errorModalTitle"
  [message]="errorModalMessage"
  [details]="errorModalDetails"
  (closeModal)="closeErrorModal()">
</app-error-modal>
